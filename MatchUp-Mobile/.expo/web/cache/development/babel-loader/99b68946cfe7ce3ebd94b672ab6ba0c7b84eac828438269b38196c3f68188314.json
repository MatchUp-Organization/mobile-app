{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport * as React from 'react';\nimport CustomButton from \"../CustomButton\";\nimport * as WebBrowser from \"expo-web-browser\";\nimport * as Google from 'expo-auth-session/providers/google';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport Navigation from \"../../navigation\";\nimport { useNavigation, useRoute } from '@react-navigation/native';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar SocialSignInButtons = function SocialSignInButtons() {\n  var navigation = useNavigation();\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    userInfo = _React$useState2[0],\n    setUserInfo = _React$useState2[1];\n  WebBrowser.maybeCompleteAuthSession();\n  var _Google$useAuthReques = Google.useAuthRequest({\n      webClientId: \"871816637044-ejvmsf74rnf29sludjqr7t60tne94sam.apps.googleusercontent.com\",\n      scopes: [\"profile\", \"email\"]\n    }),\n    _Google$useAuthReques2 = _slicedToArray(_Google$useAuthReques, 3),\n    request = _Google$useAuthReques2[0],\n    response = _Google$useAuthReques2[1],\n    promptAsync = _Google$useAuthReques2[2];\n  var getLocalUser = function () {\n    var _ref = _asyncToGenerator(function* () {\n      var data = yield AsyncStorage.getItem(\"@user\");\n      if (!data) return null;\n      return JSON.parse(data);\n    });\n    return function getLocalUser() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var getUserInfo = function () {\n    var _ref2 = _asyncToGenerator(function* (token) {\n      if (!token) return;\n      try {\n        var _response = yield fetch(\"https://www.googleapis.com/userinfo/v2/me\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        var user = yield _response.json();\n        yield AsyncStorage.setItem(\"user\", JSON.stringify(user));\n        setUserInfo(user);\n        navigation.navigate('Home');\n      } catch (error) {\n        console.error(\"Failed to fetch user data:\", response.status, response.statusText);\n      }\n    });\n    return function getUserInfo(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var onSignInFacebook = function onSignInFacebook() {\n    navigation.navigate('Home');\n  };\n  var onSignInGoogle = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      useEffect(function () {\n        handleEffect();\n      }, [response, token]);\n      function handleEffect() {\n        return _handleEffect.apply(this, arguments);\n      }\n      function _handleEffect() {\n        _handleEffect = _asyncToGenerator(function* () {\n          var user = yield getLocalUser();\n          console.log(\"user\", user);\n          if (!user) {\n            if ((response == null ? void 0 : response.type) === \"success\") {\n              getUserInfo(response.authentication.accessToken);\n            }\n          } else {\n            setUserInfo(user);\n            console.log(\"loaded locally\");\n          }\n        });\n        return _handleEffect.apply(this, arguments);\n      }\n    });\n    return function onSignInGoogle() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var onSignInApple = function onSignInApple() {\n    console.warn(\"Apple\");\n  };\n  return _jsxs(View, {\n    style: styles.container,\n    children: [!userInfo ? _jsx(Button, {\n      title: \"Sign in with Google\",\n      disabled: !request,\n      onPress: function onPress() {\n        promptAsync({\n          useProxy: false,\n          showInRecents: true\n        });\n      }\n    }) : _jsxs(View, {\n      style: styles.card,\n      children: [(userInfo == null ? void 0 : userInfo.picture) && _jsx(Image, {\n        source: {\n          uri: userInfo == null ? void 0 : userInfo.picture\n        },\n        style: styles.image\n      }), _jsxs(Text, {\n        style: styles.text,\n        children: [\"Email: \", userInfo.email]\n      }), _jsxs(Text, {\n        style: styles.text,\n        children: [\"Verified: \", userInfo.verified_email ? \"yes\" : \"no\"]\n      }), _jsxs(Text, {\n        style: styles.text,\n        children: [\"Name: \", userInfo.name]\n      })]\n    }), _jsx(Button, {\n      title: \"remove local store\",\n      onPress: _asyncToGenerator(function* () {\n        return yield AsyncStorage.removeItem(\"@user\");\n      })\n    })]\n  });\n};\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#fff\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  text: {\n    fontSize: 20,\n    fontWeight: \"bold\"\n  },\n  card: {\n    borderWidth: 1,\n    borderRadius: 15,\n    padding: 15\n  },\n  image: {\n    width: 100,\n    height: 100,\n    borderRadius: 50\n  }\n});\nexport default SocialSignInButtons;","map":{"version":3,"names":["React","CustomButton","WebBrowser","Google","AsyncStorage","Navigation","useNavigation","useRoute","jsx","_jsx","jsxs","_jsxs","SocialSignInButtons","navigation","_React$useState","useState","_React$useState2","_slicedToArray","userInfo","setUserInfo","maybeCompleteAuthSession","_Google$useAuthReques","useAuthRequest","webClientId","scopes","_Google$useAuthReques2","request","response","promptAsync","getLocalUser","_ref","_asyncToGenerator","data","getItem","JSON","parse","apply","arguments","getUserInfo","_ref2","token","fetch","headers","Authorization","user","json","setItem","stringify","navigate","error","console","status","statusText","_x","onSignInFacebook","onSignInGoogle","_ref3","useEffect","handleEffect","_handleEffect","log","type","authentication","accessToken","onSignInApple","warn","View","style","styles","container","children","Button","title","disabled","onPress","useProxy","showInRecents","card","picture","Image","source","uri","image","Text","text","email","verified_email","name","removeItem","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent","fontSize","fontWeight","borderWidth","borderRadius","padding","width","height"],"sources":["/home/alexx/MatchUp-Mobile/src/components/SocialSignInButtons/SocialSignInButtons.js"],"sourcesContent":["import { View, Text } from 'react-native'\nimport * as React from 'react'\nimport CustomButton from '../CustomButton'\nimport * as WebBrowser from \"expo-web-browser\";\nimport * as Google from 'expo-auth-session/providers/google';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport Navigation from '../../navigation';\nimport { useNavigation, useRoute } from '@react-navigation/native';\n\nconst SocialSignInButtons = () => {\n  \n  const navigation = useNavigation();\n  const [userInfo, setUserInfo] = React.useState(null);\n  WebBrowser.maybeCompleteAuthSession();\n  \n  const [request, response, promptAsync] = Google.useAuthRequest({\n\n    webClientId:\"871816637044-ejvmsf74rnf29sludjqr7t60tne94sam.apps.googleusercontent.com\",\n    scopes: [\"profile\", \"email\"]\n\n  });\n\n\n  const getLocalUser = async () => {\n    const data = await AsyncStorage.getItem(\"@user\");\n    if (!data) return null;\n    return JSON.parse(data);\n  };\n\n  const getUserInfo = async (token) => {\n    //absent token\n    if (!token) return;\n    //present token\n    try {\n      const response = await fetch(\n        \"https://www.googleapis.com/userinfo/v2/me\",\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      );\n      const user = await response.json();\n      //store user information  in Asyncstorage\n      await AsyncStorage.setItem(\"user\", JSON.stringify(user));\n      setUserInfo(user);\n      navigation.navigate('Home');\n    } catch (error) {\n      console.error(\n        \"Failed to fetch user data:\",\n        response.status,\n        response.statusText\n      );\n    }\n  };\n\n  const onSignInFacebook = () => {\n    navigation.navigate('Home');\n  }\n\n  const onSignInGoogle = async () => {\n    useEffect(() => {\n      handleEffect();\n    }, [response, token]);\n    async function handleEffect() {\n      const user = await getLocalUser();\n      console.log(\"user\", user);\n      if (!user) {\n        if (response?.type === \"success\") {\n          // setToken(response.authentication.accessToken);\n          getUserInfo(response.authentication.accessToken);\n        }\n      } else {\n        setUserInfo(user);\n        console.log(\"loaded locally\");\n      }\n    }\n  }\n\n    const onSignInApple= () => {\n      console.warn(\"Apple\");\n    }\n    \n    return (\n      <View style={styles.container}>\n        {!userInfo ? (\n          <Button\n            title=\"Sign in with Google\"\n            disabled={!request}\n            onPress={() => {\n              promptAsync({ useProxy: false, showInRecents: true });\n            }}\n          />\n        ) : (\n          <View style={styles.card}>\n            {userInfo?.picture && (\n              <Image source={{ uri: userInfo?.picture }} style={styles.image} />\n            )}\n            <Text style={styles.text}>Email: {userInfo.email}</Text>\n            <Text style={styles.text}>\n              Verified: {userInfo.verified_email ? \"yes\" : \"no\"}\n            </Text>\n            <Text style={styles.text}>Name: {userInfo.name}</Text>\n            {/* <Text style={styles.text}>{JSON.stringify(userInfo, null, 2)}</Text> */}\n          </View>\n        )}\n        <Button\n          title=\"remove local store\"\n          onPress={async () => await AsyncStorage.removeItem(\"@user\")}\n        />\n      </View>\n    );\n  }\n  \n  const styles = StyleSheet.create({\n    container: {\n      flex: 1,\n      backgroundColor: \"#fff\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n    },\n    text: {\n      fontSize: 20,\n      fontWeight: \"bold\",\n    },\n    card: {\n      borderWidth: 1,\n      borderRadius: 15,\n      padding: 15,\n    },\n    image: {\n      width: 100,\n      height: 100,\n      borderRadius: 50,\n    },\n  });\n\nexport default SocialSignInButtons"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}